<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Data Commons - Timelines</title>
<link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link type="text/css" href="/localsite/css/base.css" rel="stylesheet" id="/localsite/css/base.css" />
<script type="text/javascript" src="/localsite/js/localsite.js?showheader=true&showsearch=true&scope=county"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="../../../localsite/js/earthscape.js" type="text/javascript"></script>

<script>
loadMarkdown("index.md", "readmeDiv", "_parent");
loadMarkdown("/localsite/start/steps/github-push.md", "githubPushDiv", "_parent");

/* Also update home/index.html */
document.addEventListener('hashChangeEvent', function (elem) {
    console.log("Timeline page detects URL hashChangeEvent");
    let hash = getHash();
    if (hash.scope != priorHash.scope || hash.goal != priorHash.goal) {
        updateDcidSelectFromSheet(hash.scope);
    }
}, false);
document.addEventListener('DOMContentLoaded', () => {
    let hash = getHash();
    if (!hash.scope) {
        hash.scope = document.getElementById('selectScope').options[document.getElementById('selectScope').selectedIndex].text;
    }
    // not needed since hashChangeEvent calls on page load.
    //updateDcidSelectFromSheet(hash.scope);
    
    document.addEventListener('change', function(event) {
        if (event.target.name === 'countyShow') {
          //alert('Radio button changed! ' + event.target.value);
          refreshTimeline();
        }
    });

    document.getElementById('chartVariable').addEventListener('change', (event) => {
        refreshTimeline();
    });

    // State menu change
    document.getElementById('entityId').addEventListener('change', (event) => {
        entityId = event.target.value;
        scope = "counties"

        refreshTimeline();

        //getTimelineChart(scope, chartVariable, entityId, showAll, chartText);
    });
});


function createLabelFromDCID(DCID) {
    return DCID
        .split('_')                        // Split on underscores
        .map(word => word.replace(/([a-z])([A-Z])/g, '$1 $2')) // Add space between CamelCase
        .join(' ');                        // Join the words back with spaces
}

function loadGoalsDropdown(theme,csvPath) {

    if (!onlineApp) {
      alert("onlineApp=false in localsite.js so not pulling from Google Sheet")
      return;
    }
    loadScript(theroot + 'js/d3.v5.min.js', function(results) {
    waitForVariable('customD3loaded', function() {
    dp = {};
    dp.googleCSV = csvPath;
    consoleLog("Google data requested " + dp.googleCSV);
    //dp.googleCSV = "DISABLEX"
    d3.csv(dp.googleCSV).then(function(data,error) { // One element containing all rows from spreadsheet

      consoleLog("Google data loaded");
      // LOAD GOOGLE SHEET
        //dp.data = makeRowValuesNumeric(data, dp.numColumns, dp.valueColumn);
        //dp.data = data;

        // Loop through data
        let goalsString = "";
        for (let i = 0; i < data.length; i++) {
          //console.log("Are we reaching hear with wastewater?");
          if (data[i]) {
              console.log("data.key: ");
              console.log(data[i]);
              if (data[i].Title) {
                //goalsString = goalsString + data[i].Title + "<br>";
              }
              if (data[i].DCID) {
                if (data[i].Scope) {
                  const scopeList = data[i].Scope.replace(/\s*,\s*/g, ',').split(',');

                  scopeList.forEach(function(scope) {
                    //goalsString = goalsString + scope + "<br>";

                    goalsString = goalsString + "<a href='timelines/air/" + data[i].DCID + "_" + scope.toLowerCase() + "_data_timeline.csv'>" + data[i].Title + "</a> (" + scope + ")<br>";
                    if (scope.toLowerCase() == "county") {
                        data[i].DCID

                        // Add option if it doesn't already exist
                        //if (!optionExists) {
                            const option = document.createElement('option');
                            option.value = data[i].DCID; // Set value dynamically from data[i].DCID
                            option.text = createLabelFromDCID(data[i].DCID);
                            chartVariable.add(option);
                        //}

                    }
                  });
                  goalsString = goalsString + "<hr>";
                } else {

                  goalsString = goalsString + "<a href='timelines/air/" + data[i].DCID + "_country_data_timeline.csv'>" + data[i].Title + "</a><br>";

                  //goalsString = goalsString + "<a href='timelines/air/Annual_Amount_Emissions_CarbonDioxide_country_data_timeline.csv'>" + data[i].Title + "</a><br>";
                }
              }
          }
        }
        // DCID has been set in #chartVariable, now use it to render chart
        //refreshTimeline();

        $("#" + theme + "Div").html(goalsString);

        // LOAD CATEGORIES TAB - Category, SubCategory, SubCategoryLong
        //localObject.unGoals[dp.show] = makeRowValuesNumeric(data, dp.numColumns, dp.valueColumn);
        
        // Save to avoid repeat calls to Google Sheet tab
        let tabName = "all"

        if(typeof localObject == 'undefined') {
            var localObject = {};
        }
        if(typeof localObject.unGoals == 'undefined') {
            localObject.unGoals = {}; // From Google Sheet tabs.
        }
        localObject.unGoals[tabName] = data;

        console.log("UN Goal Google Sheet")
        console.log(localObject.unGoals[tabName]); // Include color for mappoint at this point.
          
    }, function(error, rows) {
        consoleLog("ERROR fetching google sheet. " + error);
    });
    });
    });
}
</script>

<style>
#selectScope {
    display: block !important;
}
.heroTransparent {
  position: relative;
  background: linear-gradient(rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.95)), 
              url(/apps/img/hero/state/GA/GA-hero.jpg);
  background-size: cover; /* Scales the image to cover the div */
  background-position: center; /* Centers the image in the div */
  background-repeat: no-repeat; /* Prevents the image from repeating */
  height: 100%; /* Ensures the div's height is used */
}
.contenttoogleChartType {
    display: none;
}
.active {
    display: block;
}
</style>
</head>

<body>
<div class="heroTransparent notdark">
<div class="content contentpadding large-list">

  <!-- Also update in home repo -->
  
  <div id="relocatedScopeMenu" style="float:left"></div>
  <div id="template-container"></div>
  <div id="templateLoaded"></div>
 
  <!-- We might not use the same state menu as the search filter.
  <div id="relocatedStateMenu"></div>
  -->

  <select id="entityId">
      <option value="geoId/01">Alabama</option>
      <option value="geoId/02">Alaska</option>
      <option value="geoId/04">Arizona</option>
      <option value="geoId/05">Arkansas</option>
      <option value="geoId/06">California</option>
      <option value="geoId/08">Colorado</option>
      <option value="geoId/09">Connecticut</option>
      <option value="geoId/10">Delaware</option>
      <option value="geoId/11">District of Columbia</option>
      <option value="geoId/12">Florida</option>
      <option value="geoId/13" selected>Georgia</option>
      <option value="geoId/15">Hawaii</option>
      <option value="geoId/16">Idaho</option>
      <option value="geoId/17">Illinois</option>
      <option value="geoId/18">Indiana</option>
      <option value="geoId/19">Iowa</option>
      <option value="geoId/20">Kansas</option>
      <option value="geoId/21">Kentucky</option>
      <option value="geoId/22">Louisiana</option>
      <option value="geoId/23">Maine</option>
      <option value="geoId/24">Maryland</option>
      <option value="geoId/25">Massachusetts</option>
      <option value="geoId/26">Michigan</option>
      <option value="geoId/27">Minnesota</option>
      <option value="geoId/28">Mississippi</option>
      <option value="geoId/29">Missouri</option>
      <option value="geoId/30">Montana</option>
      <option value="geoId/31">Nebraska</option>
      <option value="geoId/32">Nevada</option>
      <option value="geoId/33">New Hampshire</option>
      <option value="geoId/34">New Jersey</option>
      <option value="geoId/35">New Mexico</option>
      <option value="geoId/36">New York</option>
      <option value="geoId/37">North Carolina</option>
      <option value="geoId/38">North Dakota</option>
      <option value="geoId/39">Ohio</option>
      <option value="geoId/40">Oklahoma</option>
      <option value="geoId/41">Oregon</option>
      <option value="geoId/42">Pennsylvania</option>
      <option value="geoId/44">Rhode Island</option>
      <option value="geoId/45">South Carolina</option>
      <option value="geoId/46">South Dakota</option>
      <option value="geoId/47">Tennessee</option>
      <option value="geoId/48">Texas</option>
      <option value="geoId/49">Utah</option>
      <option value="geoId/50">Vermont</option>
      <option value="geoId/51">Virginia</option>
      <option value="geoId/53">Washington</option>
      <option value="geoId/54">West Virginia</option>
      <option value="geoId/55">Wisconsin</option>
      <option value="geoId/56">Wyoming</option>
      <option value="geoId/72">Puerto Rico</option>
  </select>
 
   <!--
      Adjust to per capita (and SqMiles) using our nav filter file:
      https://github.com/ModelEarth/localsite/blob/main/info/data/map-filters/us-states.csv

      Or call the API directly for the additional info (population and sq miles)

      show=Count_Person

      Convert 2-char state to geoId/01 in earthscape.js
  -->

  <select id="chartVariable"></select>

    <br>
    <label> <input value="showAll" type="radio" name="countyShow" />All Counties </label>
    <label> <input value="showTop5" type="radio" name="countyShow" checked />Top 5 </label>
    <label> <input value="showBottom5" type="radio" name="countyShow" />Bottom 5 </label>

    <div id="div1" class="toogleDiv">
        <canvas id="timelineChart"></canvas>
    </div>
    <div id="div2" class="toogleDiv">
        <canvas id="lineAreaChart"></canvas>
    </div>
    <label>
        <input type="radio" name="toogleChartType" value="div1" checked> Line Chart
    </label>
    <label>
        <input type="radio" name="toogleChartType" value="div2"> Area Chart
    </label>
    <label>
        <input type="radio" name="toogleChartType" value="both"> Both
    </label>

</div>
</div>
<div class="content contentpadding large-list">
  <div id="readmeDiv"></div>

  <b>TO DO: Dropdowns above timeline</b><br><br>

  Create a DropDown called #Goals using the loadGoalsDropdown() funtion in the current index.html page.<br><br>

  When #Goals changes, update the #chartVariable dropdown with the the DCID from corresponding tab in the Google Sheet.<br><br>

  #Goals dropdown > #chartVariable dropdown<br>
  Goal (Air) > Topic (Emissions): Subtopic (Methane)<br><br>

  Goals pulled from <a href="https://docs.google.com/spreadsheets/d/1IGyvcMV5wkGaIWM5dyB-vQIXXZFJUMV3WRf_UmyLkRk/edit?usp=sharing">Google Sheet</a>:<br><br>

  <b>UN Goals</b><br>
  <div id="goalsDiv"></div>
  <br>


  <b>Health Topics</b><br>
  <div id="healthDiv"></div>
  <br>
  
  <!-- <b>Aquifers Topics</b><br>
  <div id="aquifersDiv"></div>
  <br>
  <b>Conservation Topics</b><br>
  <div id="conservationDiv"></div>
  <br>
  <b>Population Topics</b><br>
  <div id="populationDiv"></div>
  <br>
  <b>ZipCodeLevelData Topics</b><br>
  <div id="zipcodeleveldatadivDiv"></div>
  <br>
  <b>ZipCode Topics</b><br>
  <div id="zipcodedivDiv"></div>
  <br> -->
  <hr><br>

  <div id="githubPushDiv"></div>
</div>
<script>
    // Add event listener to radio buttons to call toggleDivs() on change
    // Has to reside after toogleChartType html above.
    document.querySelectorAll('input[name="toogleChartType"]').forEach((radio) => {
        radio.addEventListener('change', toggleDivs);
    });
    // Show the first div by default on page load
    toggleDivs();
</script>
</body>
</html>